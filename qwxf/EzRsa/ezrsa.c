#include <stdio.h>
#include <string.h>

#include "RSA.h"

static RSAPrivateKeyInstance private_key = {
    .len = 0x00000040,
    .n0inv = 0x4791144d,
    .n =
        {
            0x88d3bb7b, 0xfb74cad2, 0x294ac19e, 0xa0a3b008, 0xd922e408,
            0x2c0348a4, 0xaff0dcff, 0xad3bfe96, 0x61237ca0, 0x8417e86e,
            0x6f526ac9, 0x352b88cd, 0x10d72b07, 0x4c45d140, 0x247b5cc7,
            0x87fbb0e5, 0x6f962f8c, 0x7624348a, 0x94011637, 0xdc342a81,
            0x9382b654, 0x36dd43be, 0x4f28ae3d, 0xf7a5c6db, 0x8a55eed8,
            0x31ac4ff0, 0xcd8ac839, 0x42ee19b3, 0x99b72509, 0x8671bbfc,
            0x1fbf4a3e, 0xb9b25f0f, 0x2427942a, 0x1351e4f6, 0xffaf3d4a,
            0x9cb248f0, 0x2e5fa7d6, 0xebe3743a, 0xf4f341c0, 0x51ff5930,
            0x300def93, 0x4d8b5243, 0xda762eee, 0x4e9fd06d, 0xd35a79a0,
            0x6195e2fa, 0x9556608a, 0xaf663a42, 0xa3adc9c8, 0xc00631ee,
            0xd6d747c8, 0xf07f7b49, 0x5961abab, 0xec46c1f2, 0x3ad58bd5,
            0x0c4a0c91, 0x09d7354a, 0x0cf74ad7, 0x1609fab4, 0xabd773b9,
            0xfa6e5d7b, 0x91e2025a, 0x82488052, 0xa03b198b,
        },
    .rr =
        {
            0x55a7d431, 0x88f24cab, 0xe7c2f618, 0x3f5fd3e2, 0x2641c143,
            0x031c00c9, 0xa5183bda, 0x920c0ad0, 0x97545872, 0xc1af674f,
            0x144d9415, 0xbe15fbd7, 0xdfbf6e7f, 0x39bbd3f5, 0x5e408665,
            0x9003c960, 0x868718d2, 0xef9f356b, 0x8b9292ff, 0xc7a0c261,
            0xd7d12faa, 0xcceea91c, 0x2b868a34, 0x04830dc1, 0x21e59131,
            0x821d4ef0, 0x4a6cebc7, 0x77c4fb37, 0x0ee9bdf1, 0x8445307d,
            0x85ae94f2, 0x02bd8f1c, 0x65d6c273, 0x2a505d6a, 0x131879f3,
            0xf8ec53a7, 0x6adf6a97, 0xf8a6bb2a, 0x67d6deef, 0x9041a065,
            0x6dc00811, 0xe4b4c36f, 0x75133d6e, 0xaf268c41, 0x621548f6,
            0x65bdf8b2, 0x806247dd, 0x05d8afbe, 0x1e3cda71, 0x1aa420b2,
            0x76263428, 0xa9644110, 0xb2abfa16, 0xb3670f9f, 0xe79b8438,
            0xea181261, 0xddbf56eb, 0x2ec11dfd, 0xc37af5cc, 0xd080b1d8,
            0xac66e10e, 0x47f7abfc, 0x5e27a3d6, 0x5bd565f5,
        },
    .d =
        {
            0xdbc6b7d5, 0x7283f112, 0xd5745d94, 0x637b6c41, 0x5a85b6e5,
            0xa70957a2, 0x590c3cf3, 0xe63fdfc3, 0x8d3a594a, 0xd4919d66,
            0x6c8edc20, 0xf4ae7ef0, 0xc5180ec3, 0x28a1a46b, 0x957e96d9,
            0x3620307e, 0xbe86fbb6, 0xed1e41a2, 0xa2f83860, 0x457c627c,
            0xdca4c81b, 0x8d44037b, 0x4883ca22, 0x98a1d183, 0x153448d3,
            0x017d2000, 0xcb96fe7d, 0x43979ce7, 0x0d097e1d, 0x9387625f,
            0x411df37f, 0x336a926f, 0x97a476d1, 0x7af3ce08, 0x20834051,
            0x4a6c4f29, 0x627f79b9, 0x42c3767b, 0x7ed136e2, 0xa721e84e,
            0xd3f1bced, 0x625ba280, 0xaabf045d, 0xcc681c0d, 0xe34be8fe,
            0x34961c29, 0xc21975cf, 0x461a41cc, 0x4f87a6bd, 0x64fc8627,
            0x0346baff, 0x034237ed, 0xc9274117, 0x35fec126, 0xad777432,
            0xf154e7c1, 0xa6fa842f, 0xa13c61dc, 0xaf8a87f8, 0x1c60ff57,
            0xc22c8a45, 0x666179b5, 0xf52c6c30, 0x27ebe1a6,
        },
    .d_bit_len = 0x000007fe};

const uint8_t answer[] = {
    0x69, 0xBA, 0xC2, 0x80, 0x3D, 0x04, 0xFD, 0x8A, 0x78, 0x10, 0x70, 0x74,
    0x20, 0x59, 0x21, 0xCB, 0x40, 0x30, 0x89, 0x4B, 0x35, 0xAF, 0xBF, 0x31,
    0xAC, 0x28, 0x46, 0x74, 0x30, 0x6F, 0xB4, 0xD3, 0x6C, 0x1A, 0x9F, 0x8D,
    0xE9, 0x84, 0xB9, 0xA6, 0x54, 0xE3, 0xBC, 0x88, 0xB3, 0xAD, 0x42, 0x28,
    0xEC, 0xAE, 0x40, 0x05, 0x49, 0xDA, 0x48, 0x0E, 0xA3, 0x12, 0x5D, 0xCA,
    0xC7, 0xED, 0x3D, 0x27, 0x34, 0x4E, 0x08, 0xCB, 0xD9, 0x5A, 0x72, 0xB0,
    0x97, 0x26, 0x79, 0xCF, 0x15, 0x22, 0x09, 0xCC, 0xE4, 0x5B, 0xC3, 0x90,
    0xB5, 0xA6, 0x52, 0x20, 0xF0, 0xC4, 0x28, 0x49, 0xBD, 0x0D, 0xC7, 0x44,
    0xF9, 0x2D, 0x90, 0xBD, 0x41, 0x70, 0x07, 0x50, 0x47, 0x3D, 0xB0, 0xA9,
    0xB6, 0x48, 0xA1, 0x12, 0xAE, 0xE1, 0x0D, 0xED, 0x3C, 0x9C, 0x76, 0x3E,
    0x7A, 0xF6, 0x52, 0x05, 0x45, 0x11, 0x93, 0xBF, 0xB4, 0x1E, 0x5D, 0xFE,
    0x2C, 0x1D, 0x73, 0xF7, 0x9F, 0xCC, 0xDB, 0xEC, 0x96, 0x5C, 0x6D, 0x22,
    0x1B, 0x75, 0x25, 0x4F, 0x34, 0x50, 0xE9, 0x62, 0x08, 0xB0, 0x27, 0x6B,
    0x56, 0xBF, 0x6C, 0x08, 0x23, 0xD8, 0xCB, 0xC4, 0xE3, 0xD1, 0x1D, 0xF6,
    0x6C, 0xC1, 0x94, 0x85, 0x01, 0x01, 0x6A, 0x83, 0xA5, 0xEF, 0x50, 0xEA,
    0x32, 0x70, 0x63, 0xD1, 0xB1, 0x7A, 0xE8, 0xEB, 0xB2, 0xAA, 0x2D, 0x3D,
    0xF1, 0x4D, 0x70, 0x1D, 0x71, 0x41, 0x44, 0xB5, 0xAD, 0xCF, 0xC1, 0xBA,
    0x10, 0x0B, 0xC7, 0xEF, 0x65, 0x02, 0xD5, 0xDB, 0x72, 0xC4, 0xDF, 0xB1,
    0xAE, 0xC3, 0x8A, 0xE5, 0xF8, 0xEF, 0x78, 0xA6, 0xF0, 0x6A, 0xF8, 0x1F,
    0x1C, 0x3F, 0x68, 0x4D, 0x41, 0xD6, 0xAB, 0x7B, 0xAF, 0x3D, 0x90, 0xD5,
    0x51, 0x4D, 0x52, 0x31, 0x53, 0xFE, 0x43, 0xDA, 0x09, 0x3A, 0xB1, 0x45,
    0x89, 0x89, 0xA7, 0x29,
};

#ifdef DECODE_TEST
void decode_test()
{
  uint8_t buffer[256];
  uint8_t out[256];
  memcpy(buffer, answer, 256);
  RSA2048_Encrypt(&private_key, buffer, 256, out);
  memset(buffer, 256, 0);
  memcpy(buffer, out + 1, 255);
  printf("%s\n", buffer);
}
#endif// DECODE_TEST

// WHUCTF{545B76DB-DD8E-8740-74C9-F06DA947188D}
int main() {
#ifdef DECODE_TEST
  decode_test();
#endif // DECODE_TEST
  printf("Please input: ");
  char buffer[0x100] = {0};
  scanf("%255s", buffer);
  if (strlen(buffer) != 44) {
    printf("Wrong input length!\n");
    return 1;
  }

  if (memcmp(buffer, "WHUCTF{", 7))
  {
    printf("Wrong string begin!\n");
    return 1;
  }

  if (buffer[43] != '}')
  {
    printf("Wrong string end!\n");
    return 1;
  }

  RSAPublicKey public_key = (RSAPublicKey)&private_key;

  uint8_t input[256] = {0};
  uint8_t output[256] = {0};
  memcpy(input + 1, buffer, 44);
  if (0 == RSA2048_Decrypt(public_key, input, 256, output)) {
    printf("Failed to decrypt data!\n");
    return 1;
  }

  if (0 == memcmp(output + 1, answer + 1, 255)) {
    printf("Correct!\n");
    return 0;
  } else {
    printf("Wrong!\n");
    return 0;
  }
}